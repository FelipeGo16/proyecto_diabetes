<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Evaluación de Riesgo de Diabetes</title>

    <!-- BOOTSTRAP 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { background: #f7f9fc; }
        .card { border-radius: 15px; }
        .progress { height: 10px; }
    </style>
</head>

<body>

<!-- =========================== -->
<!-- HEADER -->
<!-- =========================== -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/">Diabetes Predictor</a>
    </div>
</nav>

<!-- =========================== -->
<!-- CONTENIDO -->
<!-- =========================== -->
<div class="container mt-4">

    <!-- Barra de progreso -->
    <div class="mb-4">
        <label class="fw-bold">Progreso:</label>
        <div class="progress">
            <div id="barraProgreso" class="progress-bar bg-success" style="width: 50%;"></div>
        </div>
    </div>

    <h2 class="text-center mb-4 fw-bold">Evaluación de Riesgo de Diabetes</h2>

    <form action="/predecir" method="POST" id="formDiabetes">

        <!-- ============================= -->
        <!-- PASO 1 -->
        <!-- ============================= -->
        <div id="paso1" class="card p-4 shadow">

            <h4 class="mb-3">1. Información familiar</h4>

            <div id="familiares_container">
                <div class="row mb-3">
                    <div class="col">
                        <label>Parentesco</label>
                        <select name="generacion[]" class="form-select">
                            <option value="1">1 - Padres o hijos</option>
                            <option value="2">2 - Abuelos o tíos</option>
                            <option value="3">3 - Primos u otros</option>
                        </select>
                    </div>

                    <div class="col">
                        <label>¿Tiene diabetes?</label>
                        <select name="diabetes[]" class="form-select">
                            <option value="1">Sí</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                </div>
            </div>

            <button type="button" class="btn btn-secondary" onclick="agregarFamiliar()">Agregar familiar</button>
            <button type="button" class="btn btn-success float-end" onclick="calcularPEDI()">Continuar</button>

        </div>

        <!-- ============================= -->
        <!-- PASO 2 -->
        <!-- ============================= -->
        <div id="paso2" class="card p-4 shadow d-none">

            <h4 class="mb-3">2. Datos clínicos</h4>

            <input type="hidden" name="pedi" id="pedi_calculado">

            <div class="row mb-3">
                <div class="col">
                    <label>Embarazos</label>
                    <input type="number" class="form-control" name="preg" required>
                </div>
                <div class="col">
                    <label>Glucosa</label>
                    <input type="number" class="form-control" name="plas" required>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col">
                    <label>Presión arterial</label>
                    <input type="number" class="form-control" name="pres" required>
                </div>
                <div class="col">
                    <label>Grosor de piel</label>
                    <input type="number" class="form-control" name="skin" required>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col">
                    <label>Insulina</label>
                    <input type="number" class="form-control" name="test" required>
                </div>
                <div class="col">
                    <label>IMC</label>
                    <input type="number" class="form-control" name="mass" step="0.1" required>
                </div>
            </div>

            <div class="mb-3">
                <label>Edad</label>
                <input type="number" class="form-control" name="age" required>
            </div>

            <button type="submit" class="btn btn-primary w-100">Calcular Riesgo</button>

        </div>

    </form>
</div>

<!-- =========================== -->
<!-- FOOTER -->
<!-- =========================== -->
<footer class="bg-dark text-white text-center mt-5 p-3">
    <small>© 2025 Evaluador de Riesgo de Diabetes — Proyecto académico</small>
</footer>


<!-- SCRIPTS -->
<script>
function agregarFamiliar() {
    document.getElementById("familiares_container").insertAdjacentHTML("beforeend", `
        <div class="row mb-3">
            <div class="col">
                <select name="generacion[]" class="form-select">
                    <option value="1">1 - Padres o hijos</option>
                    <option value="2">2 - Abuelos o tíos</option>
                    <option value="3">3 - Primos u otros</option>
                </select>
            </div>
            <div class="col">
                <select name="diabetes[]" class="form-select">
                    <option value="1">Sí</option>
                    <option value="0">No</option>
                </select>
            </div>
        </div>
    `);
}

function calcularPEDI() {

    let gens = [...document.getElementsByName("generacion[]")].map(e => parseInt(e.value));
    let dias = [...document.getElementsByName("diabetes[]")].map(e => parseInt(e.value));

    let pesos = gens.map(g => 1 / (2 ** g));
    let contrib = dias.map((d, i) => pesos[i] * d);

    let pedi = contrib.reduce((a, b) => a + b, 0) / pesos.reduce((a, b) => a + b, 0);
    pedi = Math.round(pedi * 1000) / 1000;

    document.getElementById("pedi_calculado").value = pedi;

    document.getElementById("paso1").classList.add("d-none");
    document.getElementById("paso2").classList.remove("d-none");

    // Barra de progreso -> 100%
    document.getElementById("barraProgreso").style.width = "100%";
}
</script>

</body>
</html>
